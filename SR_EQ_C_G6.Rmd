---
author: "Group 6"
date: "2025-11-24"
title: "Default of Credit Card Clients in Taiwan Dataset Analysis and Modeling using Logistic Regression in R"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

## Load Libraries

Load required packages for data manipulation, reading Excel files, and correlation visualization.

```{r load-libraries}
library(tidyverse)
library(readxl)
library(corrplot)
```

## Load Data

Load the credit card default dataset from Excel file, skipping the first row (header info).

```{r load-data}
df <- read_excel("datasets/default of credit card clients.xls", skip = 1)
df |> glimpse()
```

## Data Cleaning

Remove the ID column as it is not a predictive feature.

```{r clean-data}
df <- df |> select(-ID)
df |> head()
```

## Summary Statistics

Display descriptive statistics for all variables in the dataset.

```{r data-summary}
summary(df)
```

## Check Missing Values

Verify that there are no missing values in the dataset.

```{r check-missing}
colSums(is.na(df))
```

# Exploratory Data Analysis

## Target Variable Distribution

Visualize the distribution of default payment status to assess class balance.

```{r target-dist}
df |> ggplot(aes(x = factor(`default payment next month`))) +
  geom_bar(fill = "steelblue") +
  labs(title = "Distribution of Default Payment",
       x = "Default (0 = No, 1 = Yes)",
       y = "Count") +
  theme_minimal()
```

## Correlation Analysis

Calculate Pearson correlations between all features and the target variable. Extract and sort the top 15 features by absolute correlation strength.

```{r correlation-matrix}
corr_matrix <- cor(df)

target_col <- "default payment next month"
target_corr <- corr_matrix[, target_col]
target_corr_sorted <- sort(abs(target_corr), decreasing = TRUE)

corr_df <- data.frame(
  Variable = names(target_corr_sorted),
  Correlation = target_corr[names(target_corr_sorted)]
) |>
  filter(Variable != target_col)

head(corr_df, 15)
```

## Correlation Bar Plot

Visualize the top 15 correlations with the target variable using a horizontal bar plot. Red bars indicate positive correlation (increases default risk), blue bars indicate negative correlation (reduces default risk).

```{r corr-barplot, fig.width=10, fig.height=6}
corr_df |>
  head(15) |>
  ggplot(aes(x = reorder(Variable, abs(Correlation)), 
             y = Correlation,
             fill = ifelse(Correlation > 0, "Positive", "Negative"))) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top 15 Features Correlated with Default Payment",
       x = "Features",
       y = "Correlation Coefficient",
       fill = "Correlation Type") +
  scale_fill_manual(values = c("Positive" = "#e74c3c", "Negative" = "#3498db")) +
  theme_minimal() +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(size = 12, face = "bold"))
```

## Outlier Detection

Detect outliers using the Interquartile Range (IQR) method. Display the count of outliers for each numerical variable.

```{r outlier-detection}
# Function to detect outliers using IQR method
detect_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  sum(x < lower_bound | x > upper_bound, na.rm = TRUE)
}

# Count outliers for each numerical variable
outlier_counts <- sapply(df, detect_outliers)
outlier_summary <- data.frame(
  Variable = names(outlier_counts),
  Outlier_Count = outlier_counts
) |>
  filter(Outlier_Count > 0) |>
  arrange(desc(Outlier_Count))

print(outlier_summary)
```

## Outlier Visualization

Create boxplots for the top features to visualize outliers.

```{r outlier-boxplots, fig.width=12, fig.height=8}
top_features <- corr_df$Variable[1:6]

df |>
  select(all_of(top_features)) |>
  pivot_longer(everything(), names_to = "Variable", values_to = "Value") |>
  ggplot(aes(x = Variable, y = Value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red", outlier.size = 2) +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Boxplots of Top 6 Features - Outlier Detection",
       x = "Features",
       y = "Values") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        plot.title = element_text(size = 12, face = "bold"))
```
